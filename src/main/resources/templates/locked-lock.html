<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë´‰ì¸ëœ ìë¬¼ì‡  - MyTestWeb</title>
    <link rel="stylesheet" href="/css/dnf-lock.css">
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="/">MyTestWeb</a>
            </div>
            <ul class="nav-menu">
                <li><a href="/" class="nav-link">í™ˆ</a></li>
                <li><a href="/about" class="nav-link">ì†Œê°œ</a></li>
                <li><a href="/hello" class="nav-link">ì‹¤ì‹œê°„ ì±„íŒ…</a></li>
                <li><a href="/locked-lock" class="nav-link">ë´‰ì¸ëœ ìë¬¼ì‡ </a></li>
                <li th:if="${user != null}" class="user-info">
                    <span class="user-name" th:text="${user.username}">ì‚¬ìš©ì</span>
                    <form th:action="@{/logout}" method="post" style="display: inline;">
                        <button type="submit" class="logout-link">ë¡œê·¸ì•„ì›ƒ</button>
                    </form>
                    <a th:if="${user.isAdmin}" href="/admin" class="admin-link">ê´€ë¦¬ì</a>
                </li>
                <li th:unless="${user != null}">
                    <a href="/login" class="nav-link">ë¡œê·¸ì¸</a>
                    <a href="/register" class="nav-link">íšŒì›ê°€ì…</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- ë˜ì „ì•¤íŒŒì´í„° ìŠ¤íƒ€ì¼ ì»¨í…Œì´ë„ˆ -->
    <div class="dnf-container">
        <!-- ìƒë‹¨ í—¤ë” -->
        <div class="dnf-header">
            <div class="user-title">
                <span class="user-name" th:text="${user != null ? user.username : 'ê²ŒìŠ¤íŠ¸'}">ê²ŒìŠ¤íŠ¸</span>ë‹˜ì˜ ê³µê°œ ë´‰ì
            </div>
            <div class="booster-info">
                <div class="booster-icon">B</div>
                <div class="booster-text">booster x2</div>
            </div>
        </div>

        <!-- ì¤‘ì•™ ë³´ë¬¼ìƒì ì˜ì—­ -->
        <div class="treasure-area">
            <!-- ì¢Œì¸¡ ê¸°ì–´ -->
            <div class="gear-left"></div>
            
            <!-- ë³´ë¬¼ìƒì -->
            <div class="treasure-chest-container">
                <div class="treasure-chest" id="treasureChest">
                    <div class="chest-body">
                        <div class="chest-lock">
                            <div class="lock-keyhole"></div>
                        </div>
                    </div>
                    <div class="chest-glow" id="chestGlow"></div>
                </div>
                
                <!-- íšë“ ì•„ì´í…œ í‘œì‹œ ì˜ì—­ -->
                <div class="treasure-items" id="treasureItems"></div>
            </div>
            
            <!-- ìš°ì¸¡ ê¸°ì–´ -->
            <div class="gear-right"></div>
        </div>

        <!-- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="dnf-controls">
            <!-- ì¢Œì¸¡: ë¶€ìŠ¤í„° + ìš”êµ¬ì¬ë£Œ -->
            <div class="control-left">
                <div class="booster-section">
                    <div class="booster-icon">ğŸš€</div>
                    <div class="booster-bar">
                        <div class="booster-progress" id="boostBar"></div>
                    </div>
                    <div class="booster-text" id="boostText">0/100</div>
                </div>
                <div class="requirement-info">
                    <span class="requirement-label">ìš”êµ¬ì¬ë£Œ</span>
                    <span class="requirement-keys">ğŸ”‘ X3</span>
                </div>
            </div>

            <!-- ì¤‘ì•™: ìë¬¼ì‡  ì„ íƒ -->
            <div class="control-center">
                <div class="lock-selection">
                        <div class="lock-option selected" id="lockOption1" onclick="selectLock(1)">
                            <div class="lock-icon">
                                <div class="lock-number">âˆ</div>
                            </div>
                            <span class="lock-name">ë´‰ì¸ëœ ìë¬¼ì‡ </span>
                            <div class="radio-button selected"></div>
                        </div>
                    
                    <div class="lock-option" id="lockOption2" onclick="selectLock(2)">
                        <div class="lock-icon diamond">
                            <div class="lock-number" id="diamondLockCount">0</div>
                        </div>
                        <span class="lock-name">[M]ë´‰ì¸ëœ ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ </span>
                        <div class="radio-button"></div>
                    </div>
                </div>
                <div class="instruction">
                    í•´ë°©í•  ìë¬¼ì‡ ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”. (ë³€ê²½: TAB)
                </div>
            </div>

            <!-- ìš°ì¸¡: ë³´ìœ  ì—´ì‡  -->
            <div class="control-right">
                <div class="possession-info">
                    <span class="possession-label">ë³´ìœ í•œ í•´ë°©ì˜ ì—´ì‡ </span>
                    <span class="possession-keys">ğŸ”‘ X<span id="keyCount">0</span></span>
                </div>
            </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="action-buttons">
            <button class="unlock-btn" id="unlockButton" onclick="attemptUnlock()">
                ğŸ”“ í•´ë°©í•˜ê¸°
            </button>
            <button class="purchase-btn" onclick="showPurchaseModal()">
                ğŸ”‘ ì—´ì‡  êµ¬ë§¤
            </button>
        </div>

        <!-- ê²°ê³¼ í‘œì‹œ -->
        <div class="lock-result" id="lockResult">
            <div class="result-content">
                <div class="result-icon" id="resultIcon">ğŸ”“</div>
                <div class="result-text" id="resultText">ìë¬¼ì‡ ë¥¼ ì—´ì–´ë³´ì„¸ìš”!</div>
            </div>
        </div>


        <!-- í†µê³„ ì„¹ì…˜ -->
        <div class="lock-stats">
            <h3>ğŸ“Š í†µê³„</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">ì†Œëª¨ ì—´ì‡ </span>
                    <span class="stat-value" id="totalKeysUsed">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ì†Œëª¨ ìë¬¼ì‡ </span>
                    <span class="stat-value" id="totalLocksUsed">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ëˆ„ì  ì†Œëª¨ ê¸ˆì•¡</span>
                    <span class="stat-value" id="totalSpent">0</span>
                </div>
            </div>
        </div>

        <!-- íˆìŠ¤í† ë¦¬ ì„¹ì…˜ -->
        <div class="lock-history">
            <h3>ğŸ“œ íˆìŠ¤í† ë¦¬</h3>
            <div class="history-list" id="historyList">
                <div class="history-empty">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
            
            <!-- ëˆ„ì  ì•„ì´í…œ ëª©ë¡ -->
            <div class="accumulated-items" id="accumulatedItems" style="display: none;">
                <h4>ğŸ ëˆ„ì  íšë“ ì•„ì´í…œ</h4>
                <div class="accumulated-list" id="accumulatedList">
                    <div class="accumulated-empty">ì•„ì§ íšë“í•œ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì—´ì‡  êµ¬ë§¤ ëª¨ë‹¬ -->
    <div class="purchase-modal" id="purchaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ”‘ ì—´ì‡  êµ¬ë§¤</h3>
                <button class="close-btn" onclick="hidePurchaseModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="gold-info">
                    <span class="gold-label">ëˆ„ì  ì†Œëª¨ ê¸ˆì•¡</span>
                    <span class="gold-amount" id="modalTotalSpent">0</span>
                </div>
                <div class="purchase-options">
                    <div class="purchase-option" onclick="purchaseKeys(100)">
                        <div class="option-icon">ğŸ”‘</div>
                        <div class="option-info">
                            <div class="option-name">100ê°œ</div>
                            <div class="option-price">27,000ê³¨ë“œ</div>
                        </div>
                    </div>
                    <div class="purchase-option" onclick="purchaseKeys(200)">
                        <div class="option-icon">ğŸ”‘</div>
                        <div class="option-info">
                            <div class="option-name">200ê°œ</div>
                            <div class="option-price">54,000ê³¨ë“œ</div>
                        </div>
                    </div>
                    <div class="purchase-option" onclick="purchaseKeys(300)">
                        <div class="option-icon">ğŸ”‘</div>
                        <div class="option-info">
                            <div class="option-name">300ê°œ</div>
                            <div class="option-price">81,000ê³¨ë“œ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            keyCount: 0,
            totalKeysUsed: 0,
            totalLocksUsed: 0,
            totalSpent: 0,
            diamondLockCount: 0,
            selectedLock: 1,
            history: [],
            accumulatedItems: {}, // ëˆ„ì  ì•„ì´í…œ ì €ì¥
            isRareItemDelay: false, // ë ˆì–´ ì•„ì´í…œ ì§€ì—° ìƒíƒœ
            boostGauge: 0, // ë¶€ìŠ¤íŠ¸ ê²Œì´ì§€ (0-100)
            isBoostActive: false // ë¶€ìŠ¤íŠ¸ í™œì„±í™” ìƒíƒœ
        };

        // ì—´ì‡  êµ¬ë§¤ ê°€ê²© (100ê°œë‹¹ 27,000ê³¨ë“œ)
        const keyPrice = 270;

        // ì²« ë²ˆì§¸ ì•„ì´í…œ ë°ì´í„°ë² ì´ìŠ¤ (ì‹¤ì œ ë˜íŒŒ í™•ë¥ )
        const firstItems = [
            { name: "ì‹œë¸Œì˜ ë³´ì¡°ì¥ë¹„ ë³´ì£¼", count: 1, rate: 0.1875, value: 40000000, icon: "ğŸ’" },
            { name: "ë¬´ê¸° ê°•í™”ê¶Œ[ë¦¬ë…¸] ìƒì", count: 1, rate: 0.2500, value: 20000000, icon: "âš”ï¸" },
            { name: "ê·¸ëœë“œ ë§ˆìŠ¤í„° ê³„ì•½ íŒ¨í‚¤ì§€ 15ì¼ ìƒì", count: 1, rate: 0.4000, value: 10000000, icon: "ğŸ“¦" },
            { name: "ê³ ëŒ€ì˜ í™©ê¸ˆ ì¦í­ì„œ", count: 1, rate: 0.0350, value: 0, icon: "ğŸ“œ" },
            { name: "ì¥ë¹„ ë³´í˜¸ê¶Œ", count: 1, rate: 0.0350, value: 0, icon: "ğŸ›¡ï¸" },
            { name: "ì¦í­ ë³´í˜¸ê¶Œ", count: 1, rate: 0.0350, value: 0, icon: "ğŸ”’" },
            { name: "í•´ë°©ëœ ì¹¼ë ˆì´ë„ ë°•ìŠ¤", count: 1, rate: 4.0000, value: 0, icon: "ğŸ“¦" },
            { name: "í•´ë°©ëœ ì¹¼ë ˆì´ë„ ë°•ìŠ¤", count: 10, rate: 0.4000, value: 0, icon: "ğŸ“¦" },
            { name: "í•´ë°©ëœ ì¹¼ë ˆì´ë„ ë°•ìŠ¤", count: 30, rate: 0.1300, value: 0, icon: "ğŸ“¦" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìˆ˜ì œë¹µ", count: 10, rate: 13.9138, value: 0, icon: "ğŸ" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìˆ˜ì œë¹µ", count: 20, rate: 7.0000, value: 0, icon: "ğŸ" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìˆ˜ì œë¹µ", count: 50, rate: 3.5000, value: 0, icon: "ğŸ" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìš°ìœ ", count: 10, rate: 13.9137, value: 0, icon: "ğŸ¥›" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìš°ìœ ", count: 20, rate: 7.0000, value: 0, icon: "ğŸ¥›" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìš°ìœ ", count: 50, rate: 3.5000, value: 0, icon: "ğŸ¥›" },
            { name: "íŒ¨ì™•ì˜ ê³„ì•½ 3ì¼", count: 1, rate: 5.5000, value: 0, icon: "ğŸ“‹" },
            { name: "ë‹¬ì¸ì˜ ê³„ì•½ 3ì¼", count: 1, rate: 5.5000, value: 0, icon: "ğŸ“‹" },
            { name: "ì„±ì¥ì˜ ê³„ì•½ 3ì¼", count: 1, rate: 5.5000, value: 0, icon: "ğŸ“‹" },
            { name: "íë¸Œì˜ ê³„ì•½ 7ì¼", count: 1, rate: 5.5000, value: 0, icon: "ğŸ“‹" },
            { name: "ì‘ì¶•ëœ ë¼ì´ì–¸ ì½”ì–´", count: 10, rate: 4.0333, value: 0, icon: "ğŸ’" },
            { name: "ì‘ì¶•ëœ ë¼ì´ì–¸ ì½”ì–´", count: 30, rate: 4.0333, value: 0, icon: "ğŸ’" },
            { name: "ì‘ì¶•ëœ ë¼ì´ì–¸ ì½”ì–´", count: 50, rate: 4.0333, value: 0, icon: "ğŸ’" },
            { name: "ë¹›ë‚˜ëŠ” ì¡°í™”ì˜ ê²°ì •ì²´", count: 10, rate: 1.5667, value: 0, icon: "âœ¨" },
            { name: "ë¹›ë‚˜ëŠ” ì¡°í™”ì˜ ê²°ì •ì²´", count: 30, rate: 1.5667, value: 0, icon: "âœ¨" },
            { name: "ë¹›ë‚˜ëŠ” ì¡°í™”ì˜ ê²°ì •ì²´", count: 50, rate: 1.5667, value: 0, icon: "âœ¨" },
            { name: "ì¢…ë§ì˜ ê³„ì‹œ 1ê°œ ìƒì", count: 10, rate: 1.0000, value: 0, icon: "ğŸ“¦" },
            { name: "ì¢…ë§ì˜ ê³„ì‹œ 1ê°œ ìƒì", count: 20, rate: 0.5000, value: 0, icon: "ğŸ“¦" },
            { name: "ìƒê³µì¸í˜‘ì˜íšŒ ì€í™”", count: 10, rate: 1.6000, value: 0, icon: "ğŸª™" },
            { name: "ìƒê³µì¸í˜‘ì˜íšŒ ì€í™”", count: 20, rate: 1.5000, value: 0, icon: "ğŸª™" },
            { name: "ìƒê³µì¸í˜‘ì˜íšŒ ì€í™”", count: 30, rate: 1.5000, value: 0, icon: "ğŸª™" },
            { name: "ë§ˆìŠ¤í„° ì¹¼ë ˆì´ë„ ë°•ìŠ¤[ê³„ì •ê·€ì†]", count: 1, rate: 0.1000, value: 0, icon: "ğŸ“¦" },
            // í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜ë“¤ (0.01% í™•ë¥ )
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ìš©ë§¹ì˜ ì¶•ë³µ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì˜ê´‘ì˜ ì¶•ë³µ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì„ë¬´ ì‹œì‘]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì˜¤ë²„ë“œë¼ì´ë¸Œ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë°ìŠ¤ ë°”ì´ ë¦¬ë³¼ë²„]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[í˜ì´ìŠ¤í’€]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì‹ ê²€í•©ì¼]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì „ì¥ì˜ ì—¬ì‹ ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì”ì˜ì˜ ì¼€ì´ê°€]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì‚´ì˜ì˜ íŒŒë™]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì „ìˆ  ì§€íœ˜]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[í­ì£¼]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì˜¤ê¸°ì¡°ì›]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë§ˆë‚˜ ìµìŠ¤íŠ¸ë™íŠ¸]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì»¨ì œìŠ¤íŠ¸]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ê´‘í­í™”]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë°ìŠ¤ ë°”ì´ ë¦¬ë³¼ë²„(ì—¬)]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[í™˜ìˆ˜ í­ì£¼]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë‹¤í¬ë‹ˆìŠ¤]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì—˜ë ˆë©˜íƒˆ ë²ˆ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ê³ ëŒ€ì˜ ë„ì„œê´€]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì…°ì´í¬ ë‹¤ìš´]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[í™”ë‘”: í™ì—¼]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[í­ìŒí­ì‹]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì¹´ì´]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì˜¤ë²„ ì°¨ì§€]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ê´‘ì ì¸ ë¯¿ìŒ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì‹ íƒì˜ ê¸°ì›]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë¸Œë ˆì¸ ìŠ¤í†°]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë´‰ë§ˆì—°í™”]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì—­ì „ì˜ ìŠ¹ë¶€ì‚¬]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë¯¸ë¼í´ ë¹„ì „]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë¡œë³´í‹±ìŠ¤]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë¯¸ë¼í´ ë¹„ì „(ì—¬)]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì˜¤ë²„ ì°¨ì§€]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ìœˆë“œë‹ˆìŠ¤]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë¸”ëŸ¬ë“œ ë²ˆ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì¼ê³±ê°œì˜ ëŒ€ì£„]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì˜¤ë²„í”Œë¡œìš°]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì˜¤ëŸ¬ ëœìŠ¤]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ê°•ê¶Œ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì—­í˜ˆê¸°ê³µ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì„€ë„ìš° ë°•ì„œ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë… ë°”ë¥´ê¸°]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ê°•ê¶Œ(ì—¬)]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì½”ì–´ í”„ë ‰ì‹œìŠ¤]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë§ˆì°½ í•´ë°©]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ê³µëª…]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì›Œí¬ë¼ì´]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ê²½ê³„ë§ìƒ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë¡œë³´í‹±ìŠ¤(ì—¬)]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì•”ì‚´ìì˜ ë§ˆìŒê°€ì§]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë°˜ë“œì‹œ ì¡ëŠ”ë‹¤!]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì¶”ë½í•˜ëŠ” ì˜í˜¼]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë°˜ë“œì‹œ ì¡ëŠ”ë‹¤!(ì—¬)]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì„±ë ¹ì˜ ë©”ì´ìŠ¤]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë§ˆë‚˜ í­ì£¼]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì•”í‘ì˜ ì˜ì‹]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì¦í­]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ë’·ê³¨ëª© ì‹¸ì›€ë²•]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ê·€í˜¼ì¼ì²´]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ê¸ˆë‹¨ì˜ ì €ì£¼]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[íŠ¸ë ˆì´ìŠ¤]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì—‘í‹°ë² ì´ì…˜]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ëŸ¬ë¸”ë¦¬ í…œí¬]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ìµì‚¬ì´íŒ…]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[ì‚¬ëƒ¥ì„ ì‹œì‘í•´ë³¼ê¹Œ!]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[í•˜ì•…ì§ˆ]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[íë¸Œ ì˜¤ë¸Œ ë§ˆí…Œë¦¬ì–¼ë¦¬ì¦˜]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" },
            { name: "í”Œë˜í‹°ë„˜ ì— ë¸”ë ˜[squadë¬´ê¸°ê°•í™”]", count: 1, rate: 0.0100, value: 0, icon: "ğŸ†" }
        ];

        // ë‘ ë²ˆì§¸ ì•„ì´í…œ ë°ì´í„°ë² ì´ìŠ¤ (ì‹¤ì œ ë˜íŒŒ í™•ë¥ )
        const secondItems = [
            { name: "ì‹œë¸Œì˜ ë³´ì¡°ì¥ë¹„ ë³´ì£¼", count: 1, rate: 0.1875, value: 40000000, icon: "ğŸ’" },
            { name: "ë¬´ê¸° ê°•í™”ê¶Œ[ë¦¬ë…¸] ìƒì", count: 1, rate: 0.2500, value: 20000000, icon: "âš”ï¸" },
            { name: "ê·¸ëœë“œ ë§ˆìŠ¤í„° ê³„ì•½ íŒ¨í‚¤ì§€ 15ì¼ ìƒì", count: 1, rate: 0.4000, value: 10000000, icon: "ğŸ“¦" },
            { name: "ê³ ëŒ€ì˜ í™©ê¸ˆ ì¦í­ì„œ", count: 1, rate: 0.0250, value: 0, icon: "ğŸ“œ" },
            { name: "ì¥ë¹„ ë³´í˜¸ê¶Œ", count: 1, rate: 0.0250, value: 0, icon: "ğŸ›¡ï¸" },
            { name: "ì¦í­ ë³´í˜¸ê¶Œ", count: 1, rate: 0.0250, value: 0, icon: "ğŸ”’" },
            { name: "+12 ì¦í­ê¶Œ ìƒì", count: 1, rate: 0.1200, value: 0, icon: "ğŸ“¦" },
            { name: "+12 ê°•í™”ê¶Œ ìƒì", count: 1, rate: 0.1928, value: 0, icon: "ğŸ“¦" },
            { name: "+11 ì¦í­ê¶Œ ìƒì", count: 1, rate: 0.2841, value: 0, icon: "ğŸ“¦" },
            { name: "+11 ê°•í™”ê¶Œ ìƒì", count: 1, rate: 0.7258, value: 0, icon: "ğŸ“¦" },
            { name: "+10 ì¦í­ê¶Œ ìƒì", count: 1, rate: 0.2458, value: 0, icon: "ğŸ“¦" },
            { name: "+10 ê°•í™”ê¶Œ ìƒì", count: 1, rate: 0.8651, value: 0, icon: "ğŸ“¦" },
            { name: "+7 ì¦í­ê¶Œ ìƒì", count: 1, rate: 1.6927, value: 0, icon: "ğŸ“¦" },
            { name: "+7 ê°•í™”ê¶Œ ìƒì", count: 1, rate: 3.8836, value: 0, icon: "ğŸ“¦" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìˆ˜ì œë¹µ", count: 10, rate: 15.5336, value: 0, icon: "ğŸ" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìˆ˜ì œë¹µ", count: 20, rate: 5.0050, value: 0, icon: "ğŸ" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìˆ˜ì œë¹µ", count: 50, rate: 2.5026, value: 0, icon: "ğŸ" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìš°ìœ ", count: 10, rate: 15.5335, value: 0, icon: "ğŸ¥›" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìš°ìœ ", count: 20, rate: 5.0050, value: 0, icon: "ğŸ¥›" },
            { name: "ì¹¸ë‚˜ì˜ ë§›ìˆëŠ” ìš°ìœ ", count: 50, rate: 2.5026, value: 0, icon: "ğŸ¥›" },
            { name: "íŒ¨ì™•ì˜ ê³„ì•½ 3ì¼", count: 1, rate: 4.5000, value: 0, icon: "ğŸ“‹" },
            { name: "ë‹¬ì¸ì˜ ê³„ì•½ 3ì¼", count: 1, rate: 4.5000, value: 0, icon: "ğŸ“‹" },
            { name: "ì„±ì¥ì˜ ê³„ì•½ 3ì¼", count: 1, rate: 4.5000, value: 0, icon: "ğŸ“‹" },
            { name: "íë¸Œì˜ ê³„ì•½ 7ì¼", count: 1, rate: 4.5000, value: 0, icon: "ğŸ“‹" },
            { name: "í•´ë°©ëœ ì¹¼ë ˆì´ë„ ë°•ìŠ¤", count: 1, rate: 2.8600, value: 0, icon: "ğŸ“¦" },
            { name: "í•´ë°©ëœ ì¹¼ë ˆì´ë„ ë°•ìŠ¤", count: 10, rate: 0.2860, value: 0, icon: "ğŸ“¦" },
            { name: "í•´ë°©ëœ ì¹¼ë ˆì´ë„ ë°•ìŠ¤", count: 30, rate: 0.0930, value: 0, icon: "ğŸ“¦" },
            { name: "ì‘ì¶•ëœ ë¼ì´ì–¸ ì½”ì–´", count: 10, rate: 4.0902, value: 0, icon: "ğŸ’" },
            { name: "ì‘ì¶•ëœ ë¼ì´ì–¸ ì½”ì–´", count: 30, rate: 4.0902, value: 0, icon: "ğŸ’" },
            { name: "ì‘ì¶•ëœ ë¼ì´ì–¸ ì½”ì–´", count: 50, rate: 4.0902, value: 0, icon: "ğŸ’" },
            { name: "ë¹›ë‚˜ëŠ” ì¡°í™”ì˜ ê²°ì •ì²´", count: 10, rate: 1.5667, value: 0, icon: "âœ¨" },
            { name: "ë¹›ë‚˜ëŠ” ì¡°í™”ì˜ ê²°ì •ì²´", count: 30, rate: 1.5667, value: 0, icon: "âœ¨" },
            { name: "ë¹›ë‚˜ëŠ” ì¡°í™”ì˜ ê²°ì •ì²´", count: 50, rate: 1.5667, value: 0, icon: "âœ¨" },
            { name: "ì¢…ë§ì˜ ê³„ì‹œ 1ê°œ ìƒì", count: 10, rate: 1.0000, value: 0, icon: "ğŸ“¦" },
            { name: "ì¢…ë§ì˜ ê³„ì‹œ 1ê°œ ìƒì", count: 20, rate: 0.5000, value: 0, icon: "ğŸ“¦" },
            { name: "ìƒê³µì¸í˜‘ì˜íšŒ ì€í™”", count: 10, rate: 2.0000, value: 0, icon: "ğŸª™" },
            { name: "ìƒê³µì¸í˜‘ì˜íšŒ ì€í™”", count: 20, rate: 2.0000, value: 0, icon: "ğŸª™" },
            { name: "ìƒê³µì¸í˜‘ì˜íšŒ ì€í™”", count: 30, rate: 1.1856, value: 0, icon: "ğŸª™" },
            { name: "ë§ˆìŠ¤í„° ì¹¼ë ˆì´ë„ ë°•ìŠ¤[ê³„ì •ê·€ì†]", count: 1, rate: 0.1000, value: 0, icon: "ğŸ“¦" }
        ];

        // ìë¬¼ì‡  ì„ íƒ í•¨ìˆ˜
        function selectLock(lockType) {
            // ëª¨ë“  ì˜µì…˜ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.lock-option').forEach(option => {
                option.classList.remove('selected');
                option.querySelector('.radio-button').classList.remove('selected');
            });
            
            // ì„ íƒëœ ì˜µì…˜ì— selected í´ë˜ìŠ¤ ì¶”ê°€
            const selectedOption = document.getElementById(`lockOption${lockType}`);
            selectedOption.classList.add('selected');
            selectedOption.querySelector('.radio-button').classList.add('selected');
            
            gameState.selectedLock = lockType;
        }

        // ìë¬¼ì‡  í•´ì œ ì‹œë„
        function attemptUnlock() {
            const requiredKeys = 3;
            
            // ë ˆì–´ ì•„ì´í…œ ì§€ì—° ì¤‘ì´ë©´ ì°¨ë‹¨
            if (gameState.isRareItemDelay) {
                showResult("â³", "íŠ¹ë³„í•œ ì•„ì´í…œì„ ê°ìƒ ì¤‘ì…ë‹ˆë‹¤...", "info");
                return;
            }
            
            if (gameState.keyCount < requiredKeys) {
                alert(`ì—´ì‡ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!\ní•„ìš”í•œ ì—´ì‡ : ${requiredKeys}ê°œ\në³´ìœ í•œ ì—´ì‡ : ${gameState.keyCount}ê°œ\n\nì—´ì‡ ë¥¼ êµ¬ë§¤í•´ì£¼ì„¸ìš”!`);
                showResult("âš ï¸", "ì—´ì‡ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!", "error");
                return;
            }

            // ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡  ì„ íƒ ì‹œ ìˆ˜ëŸ‰ í™•ì¸
            if (gameState.selectedLock === 2 && gameState.diamondLockCount <= 0) {
                alert(`ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!\në³´ìœ í•œ ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ : ${gameState.diamondLockCount}ê°œ\n\nì¼ë°˜ ìë¬¼ì‡ ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ ë¥¼ íšë“í•´ì£¼ì„¸ìš”!`);
                showResult("ğŸ’", "ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!", "error");
                return;
            }

            // ê¸°ì¡´ ì•„ì´í…œ ì´ë¯¸ì§€ ì œê±° (ë‹¤ìŒ í•´ë°© ì‹œì—ë§Œ)
            clearItemImages();

            gameState.keyCount -= requiredKeys;
            gameState.totalKeysUsed += requiredKeys;
            gameState.totalLocksUsed++;

            // 10ë²ˆë§ˆë‹¤ ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡  ì§€ê¸‰
            if (gameState.totalLocksUsed % 10 === 0) {
                gameState.diamondLockCount++;
                showResult("ğŸ’", `ë´‰ì¸ëœ ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ ê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.`, "info");
                updateDiamondLockCount();
            }

            // ë¶€ìŠ¤íŠ¸ ê²Œì´ì§€ ì¦ê°€
            increaseBoostGauge();

            // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            startUnlockAnimation();

            // ê²°ê³¼ ê³„ì‚° (ì•½ê°„ì˜ ì§€ì—° í›„)
            setTimeout(() => {
                const result = calculateUnlockResult();
                processUnlockResult(result);
            }, 200);
        }

        // ìë¬¼ì‡  ì—´ê¸° ì• ë‹ˆë©”ì´ì…˜
        function startUnlockAnimation() {
            const chestGlow = document.getElementById('chestGlow');
            const treasureChest = document.getElementById('treasureChest');
            const unlockButton = document.getElementById('unlockButton');
            
            unlockButton.disabled = true;
            chestGlow.style.display = 'block';
            chestGlow.style.animation = 'chestGlow 0.5s ease-in-out';
            treasureChest.style.animation = 'chestOpen 0.5s ease-in-out';
        }

        // ìë¬¼ì‡  í•´ì œ ê²°ê³¼ ê³„ì‚° (ì‹¤ì œ ë˜íŒŒ í™•ë¥  ì ìš©)
        function calculateUnlockResult() {
            // ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ ì¸ì§€ í™•ì¸
            const isDiamondLock = gameState.selectedLock === 2;
            
            // ì²« ë²ˆì§¸ ì•„ì´í…œ ì„ íƒ
            const firstItem = selectItemByRate(firstItems, isDiamondLock);
            // ë‘ ë²ˆì§¸ ì•„ì´í…œ ì„ íƒ
            const secondItem = selectItemByRate(secondItems, isDiamondLock);
            
            return {
                success: true,
                items: [firstItem, secondItem]
            };
        }

        // í™•ë¥ ì— ë”°ë¥¸ ì•„ì´í…œ ì„ íƒ
        function selectItemByRate(itemList, isDiamondLock = false) {
            // ë¶€ìŠ¤íŠ¸ í™œì„±í™” ìƒíƒœì´ê±°ë‚˜ ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ ì¼ ë•Œ ìƒìœ„ 6ê°œ ì•„ì´í…œ í™•ë¥  2ë°° ì ìš©
            let adjustedItems = [...itemList];
            const shouldBoost = gameState.isBoostActive || isDiamondLock;
            
            if (shouldBoost) {
                adjustedItems = itemList.map((item, index) => {
                    if (index < 6) { // ìƒìœ„ 6ê°œ ì•„ì´í…œ
                        return {
                            ...item,
                            rate: item.rate * 2 // í™•ë¥  2ë°°
                        };
                    }
                    return item;
                });
            }
            
            const random = Math.random() * 100; // 0-100 ì‚¬ì´ì˜ ëœë¤ê°’
            let cumulative = 0;
            
            for (const item of adjustedItems) {
                cumulative += item.rate;
                if (random <= cumulative) {
                    return {
                        name: item.name,
                        count: item.count,
                        value: item.value,
                        icon: item.icon
                    };
                }
            }
            
            // ë§ˆì§€ë§‰ ì•„ì´í…œ ë°˜í™˜ (ì•ˆì „ì¥ì¹˜)
            const lastItem = adjustedItems[adjustedItems.length - 1];
            return {
                name: lastItem.name,
                count: lastItem.count,
                value: lastItem.value,
                icon: lastItem.icon
            };
        }

        // ìë¬¼ì‡  í•´ì œ ê²°ê³¼ ì²˜ë¦¬
        function processUnlockResult(result) {
            if (result.success) {
                const isDiamondLock = gameState.selectedLock === 2;
                const resultMessage = isDiamondLock ? "ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤!" : "ìë¬¼ì‡ ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤!";
                const resultIcon = isDiamondLock ? "ğŸ’" : "ğŸ”“";
                
                // ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡  ì‚¬ìš© ì‹œ ìˆ˜ëŸ‰ ê°ì†Œ
                if (isDiamondLock && gameState.diamondLockCount > 0) {
                    gameState.diamondLockCount--;
                    updateDiamondLockCount();
                }
                
                showResult(resultIcon, resultMessage, "success");
                showItemDrop(result.items); // 2ê°œ ì•„ì´í…œ ë°°ì—´ë¡œ ë³€ê²½
                addToHistory(result);
                
                // ë ˆì–´ ì•„ì´í…œì´ ìˆìœ¼ë©´ ì¶”ê°€ ì§€ì—°
                const isFirstItemRare = isRareItem(result.items[0], firstItems);
                const isSecondItemRare = isRareItem(result.items[1], secondItems);
                const hasRareItem = isFirstItemRare || isSecondItemRare;
                
                if (hasRareItem) {
                    // ë ˆì–´ ì•„ì´í…œì´ë©´ ì§€ì—° ìƒíƒœ ì„¤ì •
                    gameState.isRareItemDelay = true;
                    const unlockButton = document.getElementById('unlockButton');
                    unlockButton.textContent = 'íŠ¹ë³„í•œ ì•„ì´í…œ ê°ìƒ ì¤‘...';
                    
                    // 1ì´ˆ ì¶”ê°€ ì§€ì—°
                    setTimeout(() => {
                        updateStats();
                        resetAnimation();
                        gameState.isRareItemDelay = false; // ì§€ì—° ìƒíƒœ í•´ì œ
                    }, 1000);
                } else {
                    // ì¼ë°˜ ì•„ì´í…œì´ë©´ ì¦‰ì‹œ ì²˜ë¦¬
                    updateStats();
                    resetAnimation();
                }
                
                // ë¶€ìŠ¤íŠ¸ ì‚¬ìš© í›„ ê²Œì´ì§€ ë¦¬ì…‹
                if (gameState.isBoostActive) {
                    gameState.boostGauge = 0;
                    gameState.isBoostActive = false;
                    
                    // ë¶€ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì œê±°
                    const boostBar = document.getElementById('boostBar');
                    boostBar.style.animation = '';
                    
                    updateBoostGauge();
                    showResult("ğŸš€", "ë¶€ìŠ¤íŠ¸ê°€ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ê²Œì´ì§€ê°€ ë¦¬ì…‹ë©ë‹ˆë‹¤.", "info");
                }
            } else {
                showResult("ğŸ”’", "ìë¬¼ì‡ ê°€ ì—´ë¦¬ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.", "failure");
                addToHistory(result);
                updateStats();
                resetAnimation();
            }
        }

        // ê²°ê³¼ í‘œì‹œ
        function showResult(icon, text, type) {
            const resultIcon = document.getElementById('resultIcon');
            const resultText = document.getElementById('resultText');
            const resultDiv = document.getElementById('lockResult');

            resultIcon.textContent = icon;
            resultText.textContent = text;
            resultDiv.className = `lock-result ${type}`;
        }

        // ì•„ì´í…œ ë“œë¡­ í‘œì‹œ (ì¤‘ì•™ ë³´ë¬¼ìƒì ì˜ì—­ì—) - 2ê°œ ì•„ì´í…œ
        function showItemDrop(items) {
            const treasureItems = document.getElementById('treasureItems');
            
            // ê¸°ì¡´ ì•„ì´í…œ í‘œì‹œ ì œê±°
            treasureItems.innerHTML = '';
            
            // ìƒìœ„ 3ê°œ ì•„ì´í…œì¸ì§€ í™•ì¸
            const isFirstItemRare = isRareItem(items[0], firstItems);
            const isSecondItemRare = isRareItem(items[1], secondItems);
            const hasRareItem = isFirstItemRare || isSecondItemRare;
            
            // ë ˆì–´ ì•„ì´í…œì´ ìˆìœ¼ë©´ íŠ¹ë³„ ì´í™íŠ¸ ì‹œì‘
            if (hasRareItem) {
                startSpecialEffects();
            }
            
            // 2ê°œ ì•„ì´í…œì„ ë³´ë¬¼ìƒì ì¢Œìš°ë¡œ ë¶„ë¦¬ ë°°ì¹˜
            items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'treasure-item';
                itemElement.style.top = '60%'; // ë³´ë¬¼ìƒì ì•„ë˜ìª½
                itemElement.style.left = index === 0 ? '15%' : '85%'; // ì™¼ìª½/ì˜¤ë¥¸ìª½ ë°°ì¹˜
                
                // ë ˆì–´ ì•„ì´í…œì¸ì§€ í™•ì¸í•˜ì—¬ íŠ¹ë³„ í´ë˜ìŠ¤ ì¶”ê°€
                const isRare = (index === 0 && isFirstItemRare) || (index === 1 && isSecondItemRare);
                if (isRare) {
                    itemElement.classList.add('rare-item');
                }
                
                itemElement.innerHTML = `
                    <div class="treasure-item-content ${isRare ? 'rare-content' : ''}">
                        <div class="treasure-item-icon">${item.icon}</div>
                        <div class="treasure-item-name">${item.name} x${item.count}</div>
                        <div class="treasure-item-value">${item.value > 0 ? item.value.toLocaleString() + 'ê³¨ë“œ' : 'ê°€ê²© ì •ë³´ ì—†ìŒ'}</div>
                        ${isRare ? '<div class="rare-badge">âœ¨ ë ˆì–´ âœ¨</div>' : ''}
                    </div>
                `;
                
                // ë³´ë¬¼ìƒì ì˜ì—­ì— ì•„ì´í…œ í‘œì‹œ
                treasureItems.appendChild(itemElement);
                
                // ì•„ì´í…œ ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ (ìˆœì°¨ì ìœ¼ë¡œ)
                setTimeout(() => {
                    itemElement.style.opacity = '1';
                    itemElement.style.transform = 'translateX(-50%) scale(1)';
                    
                    // ë ˆì–´ ì•„ì´í…œì´ë©´ ì¶”ê°€ ì• ë‹ˆë©”ì´ì…˜
                    if (isRare) {
                        itemElement.style.animation = 'rareItemGlow 2s ease-in-out infinite';
                    }
                }, 100 + (index * 200)); // 0.2ì´ˆ ê°„ê²©ìœ¼ë¡œ ìˆœì°¨ ë“±ì¥
                
                // ì•„ì´í…œ ì´ë¯¸ì§€ ìœ ì§€ (ìë™ìœ¼ë¡œ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ)
                // setTimeout(() => {
                //     itemElement.style.opacity = '0';
                //     itemElement.style.transform = 'translateX(-50%) scale(0.8)';
                //     setTimeout(() => {
                //         if (itemElement.parentNode) {
                //             itemElement.remove();
                //         }
                //     }, 300);
                // }, 3000);
            });
        }
        
        // ìƒìœ„ 3ê°œ ì•„ì´í…œì¸ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        function isRareItem(item, itemList) {
            const itemIndex = itemList.findIndex(listItem => 
                listItem.name === item.name && listItem.count === item.count
            );
            return itemIndex >= 0 && itemIndex < 3; // ìƒìœ„ 3ê°œ ì•„ì´í…œ
        }

        // ê¸°ì¡´ ì•„ì´í…œ ì´ë¯¸ì§€ ì œê±°
        function clearItemImages() {
            const treasureArea = document.querySelector('.treasure-area');
            if (treasureArea) {
                const existingItems = treasureArea.querySelectorAll('.treasure-item');
                existingItems.forEach(item => {
                    if (item.parentNode) {
                        item.remove();
                    }
                });
            }
        }
        
        // íŠ¹ë³„ ì´í™íŠ¸ ì‹œì‘
        function startSpecialEffects() {
            // í™”ë©´ ì „ì²´ì— íŠ¹ë³„ ì´í™íŠ¸ ì¶”ê°€
            const specialEffects = document.createElement('div');
            specialEffects.className = 'special-effects';
            specialEffects.innerHTML = `
                <div class="fireworks">
                    <div class="firework firework-1">ğŸ†</div>
                    <div class="firework firework-2">ğŸ†</div>
                    <div class="firework firework-3">ğŸ†</div>
                    <div class="firework firework-4">ğŸ†</div>
                </div>
                <div class="golden-rain">
                    <div class="gold-coin">ğŸ’°</div>
                    <div class="gold-coin">ğŸ’°</div>
                    <div class="gold-coin">ğŸ’°</div>
                    <div class="gold-coin">ğŸ’°</div>
                    <div class="gold-coin">ğŸ’°</div>
                    <div class="gold-coin">ğŸ’°</div>
                </div>
                <div class="sparkles">
                    <div class="sparkle sparkle-1">âœ¨</div>
                    <div class="sparkle sparkle-2">âœ¨</div>
                    <div class="sparkle sparkle-3">âœ¨</div>
                    <div class="sparkle sparkle-4">âœ¨</div>
                    <div class="sparkle sparkle-5">âœ¨</div>
                    <div class="sparkle sparkle-6">âœ¨</div>
                </div>
            `;
            
            document.body.appendChild(specialEffects);
            
            // 3ì´ˆ í›„ ì´í™íŠ¸ ì œê±°
            setTimeout(() => {
                if (specialEffects.parentNode) {
                    specialEffects.remove();
                }
            }, 3000);
        }

        // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
        function addToHistory(result) {
            const historyEntry = {
                attempt: gameState.totalLocksUsed,
                success: result.success,
                items: result.items || null,
                timestamp: new Date().toLocaleTimeString()
            };
            
            gameState.history.unshift(historyEntry);
            
            // ìµœëŒ€ 20ê°œê¹Œì§€ë§Œ ìœ ì§€
            if (gameState.history.length > 20) {
                gameState.history = gameState.history.slice(0, 20);
            }
            
            // ì„±ê³µí•œ ê²½ìš° ëˆ„ì  ì•„ì´í…œ ì—…ë°ì´íŠ¸
            if (result.success && result.items) {
                updateAccumulatedItems(result.items);
            }
            
            updateHistory();
        }

        // ëˆ„ì  ì•„ì´í…œ ì—…ë°ì´íŠ¸
        function updateAccumulatedItems(items) {
            items.forEach(item => {
                const key = item.name; // ì´ë¦„ë§Œìœ¼ë¡œ í‚¤ ìƒì„± (ê°œìˆ˜ ë¬´ê´€)
                if (gameState.accumulatedItems[key]) {
                    gameState.accumulatedItems[key].totalCount += item.count;
                } else {
                    gameState.accumulatedItems[key] = {
                        name: item.name,
                        count: item.count,
                        totalCount: item.count,
                        value: item.value,
                        icon: item.icon
                    };
                }
            });
            updateAccumulatedDisplay();
        }

        // ëˆ„ì  ì•„ì´í…œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateAccumulatedDisplay() {
            const accumulatedItems = document.getElementById('accumulatedItems');
            const accumulatedList = document.getElementById('accumulatedList');
            
            const itemKeys = Object.keys(gameState.accumulatedItems);
            
            if (itemKeys.length === 0) {
                accumulatedItems.style.display = 'none';
                return;
            }
            
            accumulatedItems.style.display = 'block';
            
            // ì•„ì´í…œì„ ì´ë¦„ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedItems = itemKeys
                .map(key => gameState.accumulatedItems[key])
                .sort((a, b) => a.name.localeCompare(b.name));
            
            accumulatedList.innerHTML = sortedItems.map(item => `
                <div class="accumulated-item">
                    <div class="accumulated-item-icon">${item.icon}</div>
                    <div class="accumulated-item-info">
                        <div class="accumulated-item-name">${item.name}</div>
                        <div class="accumulated-item-count">ì´ ${item.totalCount}ê°œ</div>
                        ${item.value > 0 ? `<div class="accumulated-item-value">${item.value.toLocaleString()}ê³¨ë“œ</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
        function updateHistory() {
            const historyList = document.getElementById('historyList');
            
            if (gameState.history.length === 0) {
                historyList.innerHTML = '<div class="history-empty">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            historyList.innerHTML = gameState.history.map(entry => {
                if (entry.success && entry.items) {
                    const itemsText = entry.items.map(item => 
                        `${item.name} x${item.count}${item.value > 0 ? ' (' + item.value.toLocaleString() + 'ê³¨ë“œ)' : ''}`
                    ).join(', ');
                    return `
                        <div class="history-item success">
                            <span class="history-attempt">#${entry.attempt}</span>
                            <span class="history-time">${entry.timestamp}</span>
                            <span class="history-result">ì„±ê³µ: ${itemsText}</span>
                        </div>
                    `;
                } else {
                    return `
                        <div class="history-item failure">
                            <span class="history-attempt">#${entry.attempt}</span>
                            <span class="history-time">${entry.timestamp}</span>
                            <span class="history-result">ì‹¤íŒ¨</span>
                        </div>
                    `;
                }
            }).join('');
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('totalKeysUsed').textContent = gameState.totalKeysUsed;
            document.getElementById('totalLocksUsed').textContent = gameState.totalLocksUsed;
            document.getElementById('totalSpent').textContent = gameState.totalSpent.toLocaleString();
            document.getElementById('keyCount').textContent = gameState.keyCount;
        }

        // ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡  ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateDiamondLockCount() {
            document.getElementById('diamondLockCount').textContent = gameState.diamondLockCount;
            
            // ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ ê°€ 0ê°œê°€ ë˜ë©´ ì¼ë°˜ ìë¬¼ì‡ ë¡œ ìë™ ì „í™˜
            if (gameState.diamondLockCount <= 0 && gameState.selectedLock === 2) {
                selectLock(1); // ì¼ë°˜ ìë¬¼ì‡ ë¡œ ì „í™˜
                showResult("ğŸ’", "ë‹¤ì´ì•„ëª¬ë“œ ìë¬¼ì‡ ê°€ ë¶€ì¡±í•˜ì—¬ ì¼ë°˜ ìë¬¼ì‡ ë¡œ ì „í™˜ë©ë‹ˆë‹¤.", "info");
            }
        }

        // ë¶€ìŠ¤íŠ¸ ê²Œì´ì§€ ì—…ë°ì´íŠ¸
        function updateBoostGauge() {
            const boostBar = document.getElementById('boostBar');
            const boostText = document.getElementById('boostText');
            
            boostBar.style.width = gameState.boostGauge + '%';
            boostText.textContent = `${gameState.boostGauge}/100`;
            
            // ë¶€ìŠ¤íŠ¸ í™œì„±í™” ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
            if (gameState.isBoostActive) {
                boostBar.style.background = 'linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f)';
                boostText.textContent = `${gameState.boostGauge}/100 (ë¶€ìŠ¤íŠ¸ í™œì„±!)`;
            } else {
                boostBar.style.background = 'linear-gradient(90deg, #4ecdc4, #44a08d)';
            }
        }

        // ë¶€ìŠ¤íŠ¸ ê²Œì´ì§€ ì¦ê°€
        function increaseBoostGauge() {
            const boostAmount = Math.floor(Math.random() * 3) + 1; // 1, 2, 3 ì¤‘ ëœë¤
            const actualBoost = boostAmount * 5; // 5, 10, 15 ì¤‘ ëœë¤
            
            gameState.boostGauge = Math.min(100, gameState.boostGauge + actualBoost);
            
            // 100ì— ë„ë‹¬í•˜ë©´ ë¶€ìŠ¤íŠ¸ í™œì„±í™” (ìë™ í•´ë°©í•˜ì§€ ì•ŠìŒ)
            if (gameState.boostGauge >= 100 && !gameState.isBoostActive) {
                gameState.isBoostActive = true;
                showResult("ğŸš€", "ë¶€ìŠ¤íŠ¸ ê²Œì´ì§€ê°€ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤! ë‹¤ìŒ í•´ë°©ì—ì„œ í™•ë¥ ì´ 2ë°°ë¡œ ì¦ê°€í•©ë‹ˆë‹¤!", "success");
                console.log("ë¶€ìŠ¤íŠ¸ ê²Œì´ì§€ 100 ë„ë‹¬ - ìë™ í•´ë°© ì—†ìŒ, ìˆ˜ë™ í•´ë°© í•„ìš”");
                
                // ë¶€ìŠ¤íŠ¸ í™œì„±í™” ì‹œ ì‹œê°ì  í”¼ë“œë°± ê°•í™”
                const boostBar = document.getElementById('boostBar');
                boostBar.style.animation = 'pulse 1s ease-in-out infinite';
            }
            
            updateBoostGauge();
        }

        // ì• ë‹ˆë©”ì´ì…˜ ë¦¬ì…‹
        function resetAnimation() {
            const chestGlow = document.getElementById('chestGlow');
            const treasureChest = document.getElementById('treasureChest');
            const unlockButton = document.getElementById('unlockButton');
            
            setTimeout(() => {
                chestGlow.style.display = 'none';
                chestGlow.style.animation = '';
                treasureChest.style.animation = '';
                
                // ë ˆì–´ ì•„ì´í…œ ì§€ì—° ì¤‘ì´ ì•„ë‹ˆë©´ ë²„íŠ¼ í™œì„±í™”
                if (!gameState.isRareItemDelay) {
                    unlockButton.disabled = false;
                    unlockButton.textContent = 'í•´ë°©í•˜ê¸°';
                }
            }, 500);
        }

        // ì—´ì‡  êµ¬ë§¤ ëª¨ë‹¬ í‘œì‹œ
        function showPurchaseModal() {
            document.getElementById('purchaseModal').style.display = 'block';
            updateModalGold();
        }

        // ì—´ì‡  êµ¬ë§¤ ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
        function hidePurchaseModal() {
            document.getElementById('purchaseModal').style.display = 'none';
        }

        // ëª¨ë‹¬ ê³¨ë“œ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateModalGold() {
            document.getElementById('modalTotalSpent').textContent = gameState.totalSpent.toLocaleString();
        }

        // ì—´ì‡  êµ¬ë§¤
        function purchaseKeys(amount) {
            const cost = amount * keyPrice;
            gameState.keyCount += amount;
            gameState.totalSpent += cost;
            
            updateStats();
            updateModalGold();
            hidePurchaseModal();
            
            showResult("ğŸ”‘", `${amount}ê°œì˜ ì—´ì‡ ë¥¼ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!`, "success");
        }

        // ê²Œì„ ë¦¬ì…‹
        function resetGame() {
            if (confirm('ê²Œì„ì„ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                gameState = {
                    keyCount: 0,
                    totalKeysUsed: 0,
                    totalLocksUsed: 0,
                    totalSpent: 0,
                    diamondLockCount: 0,
                    selectedLock: 1,
                    history: [],
                    accumulatedItems: {},
                    isRareItemDelay: false,
                    boostGauge: 0,
                    isBoostActive: false
                };

                document.getElementById('lockResult').className = 'lock-result';
                
                updateStats();
                updateDiamondLockCount();
                updateBoostGauge();
                updateHistory();
                updateAccumulatedDisplay();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            updateDiamondLockCount();
            updateBoostGauge();
            updateHistory();
        });
    </script>
</body>
</html>